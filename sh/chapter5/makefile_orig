# 基本路径
CURR = /Users/Wei/github/letsplayc/sh/chapter5

# subst函数按模式替换字符串
# $(subst FROM,TO,TEXT): 把字符串TEXT中的FROM字符串替换为TO
BIN = $(subst /sh/,/bin/,$(CURR))
SRC = $(subst /sh/,/src/,$(CURR))
TEST = $(subst /sh/,/test/,$(CURR))

# vpath规定特定类型文件的路径
# 注意！vpath只对依赖规则中的文件有效。对命令行还是无效
vpath %.c $(SRC)
vpath %.o $(BIN)
vpath %.exe $(BIN)


# 其他变量
cc = gcc -iquote"$(SRC)"
objects = $(BIN)/5-1.o $(BIN)/getch.o

# 依赖规则
# 只有第一个目标文件是“默认目标”
5-1.exe : 5-1.o getch.o
	$(cc) -o $(BIN)/5-1.exe $(objects)
5-1.o : 5-1.c
	$(cc) -c $(SRC)/5-1.c -o $(BIN)/5-1.o
getch.o : getch.c
	$(cc) -c $(SRC)/getch.c -o $(BIN)/getch.o

# 明确指出clean是一个伪目标
.PHONY : cleanall cleanexe cleanobj

# 伪目标：清除所有已生成的目标文件
# 伪目标只是一个标签，不生成文件
# 把伪目标置于第一个目标，也可称为默认目标
# 目标的依赖也可以是目标
cleanall : cleanexe cleanobj
cleanexe : 
	rm $(BIN)/5-1.exe 
cleanobj :
	rm $(objects)
